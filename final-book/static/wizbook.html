<!DOCTYPE html>
<html lang="en">
<head>
  <title>WizBook.io - AI Book Generator</title>
  <meta name="description" content="Turn ideas into books in 60 seconds">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="UTF-8">
  
  <!-- React & Babel with Fallback -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <!-- CDN Fallback Check -->
  <script>
    if (typeof React === 'undefined') {
      document.write('<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"><\/script>');
      document.write('<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"><\/script>');
    }
  </script>
  
  <!-- Stripe -->
  <script src="https://js.stripe.com/v3/"></script>
  
  <!-- Styles -->
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      line-height: 1.6;
    }
    
    .hero {
      text-align: center;
      padding: 80px 20px 60px;
      color: white;
    }
    
    .hero h1 {
      font-size: 4rem;
      font-weight: 800;
      margin-bottom: 20px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
    
    .hero .tagline {
      font-size: 1.5rem;
      opacity: 0.9;
      font-weight: 300;
    }
    
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 0 20px;
    }
    
    .card {
      background: rgba(255, 255, 255, 0.98);
      backdrop-filter: blur(10px);
      border-radius: 24px;
      padding: 40px;
      margin: 30px 0;
      box-shadow: 0 20px 60px rgba(0,0,0,0.15);
      border: 1px solid rgba(255,255,255,0.2);
    }
    
    .input-group {
      margin-bottom: 25px;
    }
    
    .input-group label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      color: #374151;
      font-size: 1.1rem;
    }
    
    .input-group input, .input-group select {
      width: 100%;
      padding: 16px 20px;
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      font-size: 1.1rem;
      transition: all 0.3s ease;
      background: #fafafa;
    }
    
    .input-group input:focus, .input-group select:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
      background: white;
    }
    
    .btn {
      padding: 18px 36px;
      border: none;
      border-radius: 12px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-block;
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    
    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }
    
    .btn:hover::before {
      left: 100%;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
    }
    
    .btn-success {
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
      box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
    }
    
    .btn-success:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(16, 185, 129, 0.6);
    }
    
    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    
    .btn-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin: 30px 0;
    }
    
    .loading {
      text-align: center;
      padding: 60px 20px;
    }
    
    .spinner {
      width: 50px;
      height: 50px;
      border: 4px solid #f3f4f6;
      border-top: 4px solid #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .result {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 16px;
      padding: 30px;
      margin: 25px 0;
      position: relative;
    }
    
    .result pre {
      white-space: pre-wrap;
      font-size: 0.95rem;
      line-height: 1.7;
      max-height: 500px;
      overflow-y: auto;
      font-family: 'Georgia', serif;
      color: #374151;
    }
    
    .alert {
      padding: 16px 20px;
      border-radius: 12px;
      margin: 20px 0;
      font-weight: 500;
    }
    
    .alert-success {
      background: #d1fae5;
      color: #065f46;
      border: 1px solid #10b981;
    }
    
    .alert-error {
      background: #fee2e2;
      color: #b91c1c;
      border: 1px solid #f87171;
    }
    
    .features {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 30px;
      margin: 40px 0;
    }
    
    .feature {
      text-align: center;
      padding: 30px 20px;
      background: rgba(255,255,255,0.1);
      border-radius: 16px;
      backdrop-filter: blur(10px);
    }
    
    .feature-icon {
      font-size: 3.5rem;
      margin-bottom: 15px;
      display: block;
    }
    
    .feature h3 {
      color: white;
      font-size: 1.3rem;
      margin-bottom: 10px;
    }
    
    .feature p {
      color: rgba(255,255,255,0.8);
      font-size: 1rem;
    }
    
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin: 30px 0;
      text-align: center;
    }
    
    .stat {
      background: rgba(255,255,255,0.1);
      padding: 20px;
      border-radius: 12px;
      backdrop-filter: blur(10px);
    }
    
    .stat-number {
      font-size: 2.5rem;
      font-weight: 800;
      color: white;
      display: block;
    }
    
    .stat-label {
      color: rgba(255,255,255,0.8);
      font-size: 0.9rem;
      margin-top: 5px;
    }
    
    @media (max-width: 768px) {
      .hero h1 {
        font-size: 2.5rem;
      }
      
      .hero .tagline {
        font-size: 1.2rem;
      }
      
      .card {
        padding: 25px;
        margin: 20px 0;
      }
      
      .btn-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    function WizBookApp() {
      const [step, setStep] = useState('home'); // home, pricing, generate, result
      const [selectedTier, setSelectedTier] = useState('pro');
      const [formData, setFormData] = useState({
        topic: '',
        audience: 'beginners',
        style: 'professional'
      });
      const [loading, setLoading] = useState(false);
      const [result, setResult] = useState(null);
      const [error, setError] = useState('');

      // Pricing tiers
      const pricingTiers = {
        basic: { price: 14.97, name: 'Basic', chapters: '5', features: ['AI-Generated Book', 'PDF Download', 'Standard Quality'] },
        pro: { price: 24.97, name: 'Professional', chapters: '8', features: ['AI-Generated Book', 'Premium PDF', 'Commercial Rights', '⭐ BEST VALUE'] },
        premium: { price: 49.97, name: 'Premium', chapters: '12', features: ['AI-Generated Book', 'Premium PDF', 'Commercial Rights', '3 Bonus Templates', 'Priority Support'] }
      };

      // Auto-detect API URL - PRODUCTION READY
      const API_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
        ? 'http://localhost:8001'  // Local development
        : 'https://wizbook.io';  // PRODUCTION DOMAIN - LIVE!

      const handleGenerate = async () => {
        if (!formData.topic.trim()) {
          setError('Please enter a book topic');
          return;
        }

        setLoading(true);
        setError('');

        try {
          const response = await fetch(`${API_URL}/api/generate?topic=${encodeURIComponent(formData.topic)} for ${formData.audience} in ${formData.style} style`);
          
          if (!response.ok) {
            throw new Error(`Generation failed: ${response.status}`);
          }

          const data = await response.json();
          setResult(data);
          setStep('result');
        } catch (err) {
          setError('Failed to generate book. Please try again.');
          console.error('Error:', err);
        }

        setLoading(false);
      };

      const handleDownloadPDF = async () => {
        if (!result) return;

        try {
          const response = await fetch(`${API_URL}/api/pdf?topic=${encodeURIComponent(formData.topic)}`);
          
          if (!response.ok) {
            throw new Error('PDF generation failed');
          }

          const blob = await response.blob();
          const url = window.URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `${formData.topic.replace(/[^a-z0-9]/gi, '_')}.pdf`;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          window.URL.revokeObjectURL(url);
        } catch (err) {
          setError('PDF download failed. Please try again.');
        }
      };

      const handlePayment = async () => {
        try {
          const response = await fetch(`${API_URL}/api/checkout?topic=${encodeURIComponent(formData.topic)}&tier=${selectedTier}`);
          const data = await response.json();
          
          if (data.checkout_url) {
            window.location.href = data.checkout_url;
          } else {
            setError('Payment setup required. Please add Stripe keys.');
          }
        } catch (err) {
          setError('Payment failed. Please try again.');
        }
      };

      const handleGenerateClick = () => {
        setStep('pricing');
      };

      if (loading) {
        return (
          <div className="loading">
            <div className="spinner"></div>
            <h2 style={{color: 'white', marginBottom: '10px'}}>🤖 Creating your book...</h2>
            <p style={{color: 'rgba(255,255,255,0.8)'}}>This may take 10-30 seconds for quality content</p>
          </div>
        );
      }

      if (step === 'result' && result) {
        return (
          <div className="container">
            <div className="card">
              <div style={{textAlign: 'center', marginBottom: '30px'}}>
                <h2 style={{color: '#1f2937', fontSize: '2rem', marginBottom: '10px'}}>
                  📚 Your Book is Ready!
                </h2>
                <div className="stats">
                  <div className="stat">
                    <span className="stat-number" style={{color: '#059669'}}>{result.word_count}</span>
                    <div className="stat-label" style={{color: '#6b7280'}}>Words Generated</div>
                  </div>
                  <div className="stat">
                    <span className="stat-number" style={{color: '#dc2626'}}>PDF</span>
                    <div className="stat-label" style={{color: '#6b7280'}}>Ready to Download</div>
                  </div>
                </div>
              </div>

              <div style={{textAlign: 'center', marginBottom: '30px'}}>
                <button className="btn btn-success" onClick={handleDownloadPDF} style={{marginRight: '15px'}}>
                  📄 Download PDF
                </button>
                <button className="btn btn-primary" onClick={() => setStep('home')}>
                  📝 Generate Another
                </button>
              </div>

              <div className="result">
                <pre>{result.book}</pre>
              </div>
            </div>
          </div>
        );
      }

      if (step === 'pricing') {
        return (
          <div className="container">
            <div className="card">
              <h2 style={{textAlign: 'center', marginBottom: '20px', color: '#1f2937', fontSize: '2.2rem'}}>
                Choose Your Book Package
              </h2>
              <p style={{textAlign: 'center', marginBottom: '40px', color: '#6b7280'}}>
                Topic: <strong>{formData.topic}</strong>
              </p>

              <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(280px, 1fr))', gap: '25px', marginBottom: '30px'}}>
                {Object.entries(pricingTiers).map(([tier, info]) => (
                  <div
                    key={tier}
                    onClick={() => setSelectedTier(tier)}
                    style={{
                      border: selectedTier === tier ? '3px solid #667eea' : '2px solid #e5e7eb',
                      borderRadius: '16px',
                      padding: '25px',
                      cursor: 'pointer',
                      background: selectedTier === tier ? 'rgba(102, 126, 234, 0.05)' : 'white',
                      transition: 'all 0.3s ease',
                      position: 'relative'
                    }}
                  >
                    {tier === 'pro' && (
                      <div style={{
                        position: 'absolute',
                        top: '-10px',
                        right: '20px',
                        background: '#f59e0b',
                        color: 'white',
                        padding: '5px 15px',
                        borderRadius: '20px',
                        fontSize: '0.8rem',
                        fontWeight: 'bold'
                      }}>
                        BEST VALUE
                      </div>
                    )}
                    
                    <h3 style={{fontSize: '1.5rem', marginBottom: '10px', color: '#1f2937'}}>{info.name}</h3>
                    <div style={{fontSize: '2.5rem', fontWeight: 'bold', color: '#667eea', marginBottom: '15px'}}>
                      ${info.price}
                    </div>
                    <div style={{marginBottom: '20px', color: '#6b7280'}}>
                      {info.chapters} Professional Chapters
                    </div>
                    
                    <ul style={{listStyle: 'none', padding: 0}}>
                      {info.features.map((feature, index) => (
                        <li key={index} style={{padding: '8px 0', color: '#374151', display: 'flex', alignItems: 'center'}}>
                          <span style={{color: '#10b981', marginRight: '10px'}}>✓</span>
                          {feature}
                        </li>
                      ))}
                    </ul>
                  </div>
                ))}
              </div>

              <div style={{textAlign: 'center'}}>
                <button 
                  className="btn btn-primary" 
                  onClick={handlePayment}
                  style={{fontSize: '1.2rem', padding: '20px 50px', marginRight: '15px'}}
                >
                  🚀 Get My Book - ${pricingTiers[selectedTier].price}
                </button>
                <button 
                  className="btn" 
                  onClick={() => setStep('home')}
                  style={{fontSize: '1rem', padding: '15px 30px', background: '#f3f4f6', color: '#374151'}}
                >
                  ← Back
                </button>
              </div>
            </div>
          </div>
        );
      }

      return (
        <>
          <div className="hero">
            <h1>📖 WizBook.io</h1>
            <p className="tagline">Turn ideas into books in 60 seconds</p>
            
            <div className="features">
              <div className="feature">
                <span className="feature-icon">⚡</span>
                <h3>Lightning Fast</h3>
                <p>Professional books generated in under 60 seconds</p>
              </div>
              <div className="feature">
                <span className="feature-icon">🎨</span>
                <h3>AI-Powered</h3>
                <p>Advanced AI creates comprehensive, readable content</p>
              </div>
              <div className="feature">
                <span className="feature-icon">📄</span>
                <h3>PDF Ready</h3>
                <p>Download watermarked PDFs instantly</p>
              </div>
            </div>
          </div>

          <div className="container">
            {error && (
              <div className="alert alert-error">
                {error}
              </div>
            )}

            <div className="card">
              <h2 style={{textAlign: 'center', marginBottom: '40px', color: '#1f2937', fontSize: '2.2rem'}}>
                Create Your Book
              </h2>

              <div className="input-group">
                <label htmlFor="topic">📚 What's your book about?</label>
                <input
                  id="topic"
                  type="text"
                  value={formData.topic}
                  onChange={(e) => setFormData({...formData, topic: e.target.value})}
                  placeholder="e.g., Python Programming, Digital Marketing, Coffee Shop Business Plan"
                  onKeyPress={(e) => e.key === 'Enter' && handleGenerate()}
                />
              </div>

              <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '20px', marginBottom: '25px'}}>
                <div className="input-group">
                  <label htmlFor="audience">👥 Target Audience</label>
                  <select
                    id="audience"
                    value={formData.audience}
                    onChange={(e) => setFormData({...formData, audience: e.target.value})}
                  >
                    <option value="beginners">Complete Beginners</option>
                    <option value="intermediate">Intermediate Level</option>
                    <option value="advanced">Advanced Users</option>
                    <option value="professionals">Business Professionals</option>
                    <option value="students">Students</option>
                  </select>
                </div>

                <div className="input-group">
                  <label htmlFor="style">✍️ Writing Style</label>
                  <select
                    id="style"
                    value={formData.style}
                    onChange={(e) => setFormData({...formData, style: e.target.value})}
                  >
                    <option value="professional">Professional</option>
                    <option value="casual">Casual & Friendly</option>
                    <option value="academic">Academic</option>
                    <option value="conversational">Conversational</option>
                  </select>
                </div>
              </div>

              <div style={{textAlign: 'center'}}>
                <button 
                  className="btn btn-primary" 
                  onClick={handleGenerate}
                  disabled={loading}
                  style={{fontSize: '1.2rem', padding: '20px 50px'}}
                >
                  🚀 Generate Book ($9.99)
                </button>
              </div>

              <div style={{textAlign: 'center', marginTop: '30px', fontSize: '0.9rem', color: '#6b7280'}}>
                <p>✨ Professional quality • Instant delivery • Watermarked PDFs</p>
              </div>
            </div>

            <div className="card" style={{textAlign: 'center', background: 'rgba(255,255,255,0.05)', border: '1px solid rgba(255,255,255,0.1)'}}>
              <h3 style={{color: 'white', marginBottom: '20px'}}>🔥 Popular Topics</h3>
              <div className="btn-grid">
                {[
                  'Python Programming for Beginners',
                  'Digital Marketing Strategy', 
                  'Personal Finance Guide',
                  'Content Creation Tips',
                  'Small Business Planning',
                  'AI and Machine Learning'
                ].map(topic => (
                  <button 
                    key={topic}
                    className="btn btn-primary"
                    onClick={() => setFormData({...formData, topic})}
                    style={{fontSize: '0.95rem', padding: '12px 20px'}}
                  >
                    {topic}
                  </button>
                ))}
              </div>
            </div>
          </div>
        </>
      );
    }

    ReactDOM.render(<WizBookApp />, document.getElementById('root'));
  </script>
</body>
</html>